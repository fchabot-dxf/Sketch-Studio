<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sketch Studio Config</title>
    <style>
        body { font-family: system-ui, sans-serif; padding: 20px; max-width: 700px; margin: 0 auto; background: #1e1e1e; color: #d4d4d4; }
        h1 { color: #ea580c; margin-bottom: 5px; }
        .subtitle { color: #6b7280; margin-bottom: 20px; }
        .section { background: #2d2d2d; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .section h3 { margin-top: 0; color: #3b82f6; border-bottom: 1px solid #444; padding-bottom: 8px; }
        label { display: block; margin: 10px 0 5px; color: #9ca3af; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #444; border-radius: 4px; background: #1e1e1e; color: #d4d4d4; box-sizing: border-box; }
        input[type="color"] { height: 40px; padding: 2px; cursor: pointer; }
        input[type="number"] { width: 100px; }
        button { background: #ea580c; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 14px; margin-right: 10px; }
        button:hover { background: #dc2626; }
        button.secondary { background: #3b82f6; }
        button.secondary:hover { background: #2563eb; }
        .row { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
        .row > div { flex: 1; min-width: 120px; }
        .note { font-size: 11px; color: #6b7280; margin-top: 4px; }
        .buttons { margin-top: 20px; display: flex; gap: 10px; }
        .import-area { margin-bottom: 20px; }
        .import-area textarea { height: 80px; font-family: monospace; font-size: 11px; }
        .success { color: #22c55e; }
        .instructions { background: #0d1117; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .instructions ol { margin: 10px 0; padding-left: 20px; }
        .instructions li { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>‚öôÔ∏è Sketch Studio Config</h1>
    <p class="subtitle">Visual editor for config.json</p>

    <div class="instructions">
        <strong>How to use:</strong>
        <ol>
            <li>Edit values below using sliders and color pickers</li>
            <li>Click <strong>"Download config.json"</strong></li>
            <li>Save/replace the file in your sketch-studio-unified folder</li>
            <li>Run <strong>apply-config.ps1</strong> to apply changes to source files</li>
        </ol>
    </div>

    <div class="section import-area">
        <h3>Load Config</h3>
        <div class="row" style="margin-bottom:10px">
            <button class="secondary" onclick="fetchConfig()">üìÇ Fetch config.json</button>
            <span id="fetchStatus"></span>
        </div>
        <textarea id="importJson" placeholder="Or paste JSON here manually..."></textarea>
        <button class="secondary" onclick="importConfig()" style="margin-top:10px">Load from Text</button>
        <span id="importStatus"></span>
    </div>

    <div class="section">
        <h3>Snapping</h3>
        <div class="row">
            <div>
                <label>Snap Tolerance (px)</label>
                <input type="number" id="snapPx" value="30" min="5" max="100">
                <div class="note">Distance to trigger snap</div>
            </div>
            <div>
                <label>Joint Hit Radius (px)</label>
                <input type="number" id="jointHitRadius" value="14" min="5" max="50">
                <div class="note">Click detection radius</div>
            </div>
        </div>
    </div>

    <div class="section">
        <h3>Joints (Points)</h3>
        <div class="row">
            <div>
                <label>Joint Radius</label>
                <input type="number" id="jointRadius" value="6" min="2" max="20">
            </div>
            <div>
                <label>Origin Radius</label>
                <input type="number" id="originRadius" value="8" min="2" max="20">
            </div>
            <div>
                <label>Stroke Width</label>
                <input type="number" id="jointStrokeWidth" value="2" min="1" max="10">
            </div>
        </div>
        <div class="row">
            <div>
                <label>Fill Color</label>
                <input type="color" id="jointFill" value="#ffffff">
            </div>
            <div>
                <label>Stroke Color</label>
                <input type="color" id="jointStroke" value="#2563eb">
            </div>
            <div>
                <label>Selected Fill</label>
                <input type="color" id="jointSelectedFill" value="#fbbf24">
            </div>
            <div>
                <label>Selected Stroke</label>
                <input type="color" id="jointSelectedStroke" value="#f59e0b">
            </div>
        </div>
    </div>

    <div class="section">
        <h3>Shapes</h3>
        <div class="row">
            <div>
                <label>Stroke Color</label>
                <input type="color" id="shapeStroke" value="#2563eb">
            </div>
            <div>
                <label>Stroke Width</label>
                <input type="number" id="shapeStrokeWidth" value="2" min="1" max="10">
            </div>
            <div>
                <label>Preview Color</label>
                <input type="color" id="previewStroke" value="#10b981">
            </div>
        </div>
    </div>

    <div class="section">
        <h3>Grid</h3>
        <div class="row">
            <div>
                <label>Grid Size</label>
                <input type="number" id="gridSize" value="50" min="10" max="200">
            </div>
            <div>
                <label>Grid Color</label>
                <input type="color" id="gridColor" value="#e0e0e0">
            </div>
        </div>
    </div>

    <div class="section">
        <h3>Snap Feedback</h3>
        <div class="row">
            <div>
                <label>Indicator Color</label>
                <input type="color" id="snapColor" value="#ea580c">
            </div>
            <div>
                <label>Background Color</label>
                <input type="color" id="snapBgColor" value="#fff7ed">
            </div>
        </div>
    </div>

    <div class="section">
        <h3>Canvas</h3>
        <div class="row">
            <div>
                <label>Background Color</label>
                <input type="color" id="canvasBg" value="#ffffff">
            </div>
            <div>
                <label>Default Width</label>
                <input type="number" id="viewW" value="1200" min="400" max="4000">
            </div>
            <div>
                <label>Default Height</label>
                <input type="number" id="viewH" value="800" min="300" max="3000">
            </div>
        </div>
    </div>

    <div class="buttons">
        <button onclick="downloadConfig()">üì• Download config.json</button>
        <button class="secondary" onclick="copyConfig()">üìã Copy to Clipboard</button>
    </div>
    <p id="status"></p>

    <script>
    function getVal(id) { 
        const el = document.getElementById(id);
        if(el.type === 'color') return el.value;
        return parseFloat(el.value);
    }
    
    function setVal(id, value) {
        const el = document.getElementById(id);
        if(el) el.value = value;
    }

    function buildConfig() {
        return {
            snapping: {
                snapPx: getVal('snapPx'),
                jointHitRadius: getVal('jointHitRadius')
            },
            joints: {
                radius: getVal('jointRadius'),
                originRadius: getVal('originRadius'),
                fillColor: getVal('jointFill'),
                strokeColor: getVal('jointStroke'),
                strokeWidth: getVal('jointStrokeWidth'),
                selectedFillColor: getVal('jointSelectedFill'),
                selectedStrokeColor: getVal('jointSelectedStroke')
            },
            shapes: {
                strokeColor: getVal('shapeStroke'),
                strokeWidth: getVal('shapeStrokeWidth')
            },
            preview: {
                strokeColor: getVal('previewStroke')
            },
            grid: {
                size: getVal('gridSize'),
                color: getVal('gridColor')
            },
            snap: {
                indicatorColor: getVal('snapColor'),
                backgroundColor: getVal('snapBgColor')
            },
            canvas: {
                backgroundColor: getVal('canvasBg')
            },
            view: {
                defaultWidth: getVal('viewW'),
                defaultHeight: getVal('viewH')
            }
        };
    }

    function loadConfig(cfg) {
        if(cfg.snapping) {
            setVal('snapPx', cfg.snapping.snapPx);
            setVal('jointHitRadius', cfg.snapping.jointHitRadius);
        }
        if(cfg.joints) {
            setVal('jointRadius', cfg.joints.radius);
            setVal('originRadius', cfg.joints.originRadius);
            setVal('jointFill', cfg.joints.fillColor);
            setVal('jointStroke', cfg.joints.strokeColor);
            setVal('jointStrokeWidth', cfg.joints.strokeWidth);
            setVal('jointSelectedFill', cfg.joints.selectedFillColor);
            setVal('jointSelectedStroke', cfg.joints.selectedStrokeColor);
        }
        if(cfg.shapes) {
            setVal('shapeStroke', cfg.shapes.strokeColor);
            setVal('shapeStrokeWidth', cfg.shapes.strokeWidth);
        }
        if(cfg.preview) {
            setVal('previewStroke', cfg.preview.strokeColor);
        }
        if(cfg.grid) {
            setVal('gridSize', cfg.grid.size);
            setVal('gridColor', cfg.grid.color);
        }
        if(cfg.snap) {
            setVal('snapColor', cfg.snap.indicatorColor);
            setVal('snapBgColor', cfg.snap.backgroundColor);
        }
        if(cfg.canvas) {
            setVal('canvasBg', cfg.canvas.backgroundColor);
        }
        if(cfg.view) {
            setVal('viewW', cfg.view.defaultWidth);
            setVal('viewH', cfg.view.defaultHeight);
        }
    }

    function importConfig() {
        const text = document.getElementById('importJson').value.trim();
        if(!text) {
            document.getElementById('importStatus').innerHTML = ' <span style="color:#ef4444">Paste JSON first</span>';
            return;
        }
        try {
            const cfg = JSON.parse(text);
            loadConfig(cfg);
            document.getElementById('importStatus').innerHTML = ' <span class="success">‚úì Loaded!</span>';
        } catch(e) {
            document.getElementById('importStatus').innerHTML = ' <span style="color:#ef4444">Invalid JSON</span>';
        }
    }

    function fetchConfig() {
        fetch('config.json')
            .then(r => {
                if(!r.ok) throw new Error('Not found');
                return r.json();
            })
            .then(cfg => {
                loadConfig(cfg);
                document.getElementById('importJson').value = JSON.stringify(cfg, null, 2);
                document.getElementById('fetchStatus').innerHTML = ' <span class="success">‚úì Loaded from config.json</span>';
            })
            .catch(e => {
                document.getElementById('fetchStatus').innerHTML = ' <span style="color:#ef4444">Could not fetch (need server)</span>';
            });
    }

    function downloadConfig() {
        const cfg = buildConfig();
        const json = JSON.stringify(cfg, null, 2);
        const blob = new Blob([json], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'config.json';
        a.click();
        URL.revokeObjectURL(url);
        document.getElementById('status').innerHTML = '<span class="success">‚úì Downloaded! Now run apply-config.ps1</span>';
    }

    function copyConfig() {
        const cfg = buildConfig();
        const json = JSON.stringify(cfg, null, 2);
        navigator.clipboard.writeText(json).then(() => {
            document.getElementById('status').innerHTML = '<span class="success">‚úì Copied to clipboard!</span>';
        });
    }
    </script>
</body>
</html>
