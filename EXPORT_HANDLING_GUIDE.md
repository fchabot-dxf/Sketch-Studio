# Export Handling Guide for AI Agents

## Overview

This guide documents the proper workflow for exporting and maintaining the Sketch Studio Unified application without destroying working source files. It ensures that both the modular source code and standalone export versions remain in sync and functional.

## File Structure

```
sketch-studio-unified/              (MODULAR SOURCE - PRIMARY WORKING FILES)
├── index.html                       (Entry point with script imports)
├── src/
│   ├── 1-utils.js                  (Geometry utilities, constants)
│   ├── 2-solver.js                 (Constraint solving algorithm)
│   ├── 3-snap.js                   (Snap detection logic)
│   ├── 4-render.js                 (SVG rendering engine)
│   ├── 5-engine.js                 (Engine facade, state management)
│   ├── 6-input.js                  (Input handling, dimension editing)
│   ├── 7-ui.js                     (Toolbar, shortcuts, UI logic)
│   └── 8-main.js                   (Application initialization)

export/                              (STANDALONE EXPORT - GENERATED FILES)
└── sketch-studio-unified-v1.0.html  (Single file, all scripts inlined)
```

## Critical Principles

### 1. **NEVER Directly Edit Export Files**
- The export file is **generated**, not a source of truth
- All changes must be made to source files first
- Export files should be overwritten (regenerated) when source changes

### 2. **Source Files are Primary**
- `sketch-studio-unified/index.html` and `src/*.js` are the authoritative versions
- All logic lives here first
- This is where AI agents should make edits

### 3. **Export Files are Derivatives**
- `export/sketch-studio-unified-v1.0.html` is a bundled, inlined version
- Generated by inlining all 8 modules into a single HTML file
- Used for deployment/sharing (no build step required)
- Can always be regenerated from source

## Safe Export Workflow

### Step 1: Make All Changes to Source Files Only
```
✓ CORRECT: Edit src/6-input.js → then export
✗ WRONG: Edit export/sketch-studio-unified-v1.0.html directly
```

### Step 2: Sync Changes to Export
When modifications are complete in source:

1. **For each modified source file**, find the corresponding inlined section in the export
2. **Copy the exact JavaScript code** (everything between the `// ===== filename.js =====` markers)
3. **Paste into the matching section** in the export file (between identical markers)
4. **Preserve the HTML structure** - never remove or reorganize the script tags

### Step 3: Version Numbering
```
v1.0  → Initial release version
v1.1  → Bug fixes, minor enhancements
v2.0  → Major feature additions
```

Update the version in:
- Export filename: `sketch-studio-unified-v[VERSION].html`
- HTML title: `<title>Sketch Studio Unified v[VERSION]</title>`
- Header text: `<span>Sketch Studio Unified v[VERSION]</span>`

## Detailed Sync Instructions

### When Editing Source Code

**Example: Updating 6-input.js**

1. **Make changes** in `sketch-studio-unified/src/6-input.js`
2. **Locate the section** in export file (search for `// ===== 6-input.js =====`)
3. **Replace entire section** from that marker to the next `// ===== ` marker
4. **Test the export** by opening `export/sketch-studio-unified-v1.0.html` in browser
5. **Verify functionality** matches the source behavior

### When Editing index.html

**CSS Styles:**
- Edits in `<style>` block in index.html
- Find matching `<style>` section in export
- Copy entire style block, preserving structure

**HTML Elements:**
- Changes to SVG canvas, toolbar, footer
- Locate in export file's `<body>` section
- Update corresponding elements

**Script Imports:**
- In source: `<script type="module" src="src/8-main.js"></script>`
- In export: All modules inlined as `<script>` blocks
- Do NOT add new `<script src="...">` imports to export

## Synchronization Checklist

Before considering export complete, verify:

- [ ] All source file content is inlined in export
- [ ] CSS styles from index.html are present in export
- [ ] HTML structure (toolbar, canvas, footer) matches source
- [ ] Version number updated in filename, title, and header
- [ ] All 8 modules present between their respective markers:
  - [ ] 1-utils.js
  - [ ] 2-solver.js
  - [ ] 3-snap.js
  - [ ] 4-render.js
  - [ ] 5-engine.js
  - [ ] 6-input.js
  - [ ] 7-ui.js
  - [ ] 8-main.js
- [ ] No external module imports (all must be inlined)
- [ ] CDN references preserved: Tailwind CSS, Lucide icons
- [ ] Gesture prevention scripts present at end of body
- [ ] No console errors when opened in browser

## Common Export Scenarios

### Scenario A: Bug Fix in Input Handling

```
1. Edit: sketch-studio-unified/src/6-input.js
   - Fix the bug
   - Test in modular version

2. Sync: export/sketch-studio-unified-v1.0.html
   - Find // ===== 6-input.js =====
   - Replace entire function body
   - Test in export version

3. Verify: Both versions work identically
   - No file destruction (export regenerated, not deleted)
   - Source remains clean and modular
```

### Scenario B: New Feature (Constraint Type)

```
1. Modify Multiple Files:
   - src/2-solver.js (add constraint solving logic)
   - src/4-render.js (add visual representation)
   - src/7-ui.js (add button/shortcut)

2. Test in modular version:
   - Open sketch-studio-unified/index.html
   - Verify all pieces work together

3. Sync all three files to export in sequence:
   - Each gets its own section update
   - Maintain code structure (comments, spacing)

4. Final test:
   - Open export/sketch-studio-unified-v1.0.html
   - Feature should work identically
```

### Scenario C: Release New Version

```
1. All source changes complete and tested
   - sketch-studio-unified/ fully functional

2. Export and version:
   - Create export/sketch-studio-unified-v1.1.html (new version)
   - Update all version references
   - Keep v1.0.html as backup/history

3. Test v1.1 thoroughly
   - All features functional
   - No regressions from v1.0

4. Archive old export (optional):
   - Move v1.0 to export/archived/ if desired
   - Or keep both for user download options
```

## Prevention of File Destruction

### What NOT to Do

❌ **Delete source files to "clean up"**
- Source files are needed for modular development
- Always keep complete module structure

❌ **Overwrite source with export content**
- Export is single-file, not modular
- Loses development structure

❌ **Edit export then manually sync back to source**
- Export changes get lost on next export
- Creates divergence, hard to track

❌ **Use export as working copy**
- Single-file makes debugging harder
- Becomes unmanageable for complex changes

### What TO Do

✓ **Keep both versions, refresh export from source**
- Source is development workspace
- Export is deployment artifact
- One-way sync: source → export

✓ **Version exports systematically**
- Each major change gets new version number
- Old versions remain for history
- Always know which version is "live"

✓ **Use source for all active development**
- Modular structure enables parallel work
- Easier to test individual components
- Clear change history per file

✓ **Regenerate export when multiple files change**
- Safer to sync all at once
- Reduces chance of missing updates
- Ensures consistency

## AI Agent Best Practices

### When Implementing Features

1. **Start in source directory**
   ```
   Primary work location: c:\Users\danse\Dropbox\APPS\sketch-studio-unified\
   ```

2. **Make all edits** to `.js` files or `index.html`

3. **Test modular version**
   - Open `sketch-studio-unified/index.html` in browser
   - Verify functionality works

4. **Create export** only after source is complete and tested

5. **Use multi_replace_string_in_file** when syncing multiple source files to export
   - More efficient than sequential replacements
   - Reduces token usage
   - Ensures atomic updates

### When Debugging

1. **Check source files first**
   - Modular code easier to trace
   - Can test individual components

2. **If export has issue**
   - Verify source version works
   - Check sync was complete
   - Re-sync that section if needed

3. **Never debug by editing export**
   - Changes will be lost on re-export
   - Instead, debug source and re-sync

## Module Responsibilities

Understanding what each module does helps safe export:

| Module | Purpose | Common Changes |
|--------|---------|-----------------|
| 1-utils.js | Geometry helpers, constants | Adding new coordinate transforms |
| 2-solver.js | Constraint solving | Adding constraint types |
| 3-snap.js | Hit detection, snapping | Changing snap thresholds, hit logic |
| 4-render.js | SVG rendering | Visual changes, glyph styles |
| 5-engine.js | State facade | Getter/setter methods (rarely changes) |
| 6-input.js | Input handling, dimension editing | UI interaction, pointer events |
| 7-ui.js | Toolbar, shortcuts, dropdowns | Tool buttons, keyboard bindings |
| 8-main.js | Initialization, render loop | App setup, engine creation |

## Quick Reference: Export Sync Steps

### For Single File Changes
```
1. Edit sketch-studio-unified/src/[filename].js
2. Copy updated code
3. Find // ===== [filename].js ===== in export
4. Replace content between markers
5. Test export/sketch-studio-unified-v[VERSION].html
```

### For Multiple File Changes
```
1. Edit all source files needed
2. Test sketch-studio-unified/index.html
3. Use multi_replace_string_in_file to sync all files
4. Test export/sketch-studio-unified-v[VERSION].html
5. Version increment if needed
```

### For Release
```
1. Complete all development in source
2. Sync everything to new version file
3. Test thoroughly
4. Update version numbers everywhere
5. Archive/backup old version
```

## Disaster Recovery

### If Export Gets Corrupted

```
1. Source files intact? YES
   → Delete corrupted export
   → Regenerate from source (re-sync all files)
   
2. Source files intact? YES
   → Open source in editor
   → Create fresh export file
   → Sync all 8 modules from source
```

### If Source Gets Corrupted

```
1. Export still works? YES
   → Copy export to new file
   → Extract each module (between // ===== markers)
   → Create individual src/ files
   → Update index.html imports
   → Test modular version

2. Both damaged? NO (Unlikely)
   → Check git history or backups
   → Restore from version control
```

## Workflow Summary

```
┌─────────────────────────────────────────┐
│   Development in Source Files           │
│   sketch-studio-unified/                │
│   - index.html (styles, structure)      │
│   - src/1-8.js (logic modules)          │
└────────────────┬────────────────────────┘
                 │
                 │ TEST & VERIFY
                 │ (open index.html in browser)
                 │
                 ↓
┌─────────────────────────────────────────┐
│   Export/Deploy                         │
│   sketch-studio-unified-v[X].html       │
│   - All modules inlined                 │
│   - Single file, no dependencies        │
│   - Ready for distribution              │
└─────────────────────────────────────────┘
                 │
                 │ SHARE/USE
                 │
                 ↓
         [End User Browser]
```

## Contact / Questions

For questions about this workflow:
- This guide is the source of truth for export procedures
- Always prioritize source file integrity
- When uncertain, err on the side of regenerating export from clean source
